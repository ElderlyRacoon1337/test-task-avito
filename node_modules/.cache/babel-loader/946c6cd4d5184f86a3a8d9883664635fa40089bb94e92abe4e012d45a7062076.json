{"ast":null,"code":"import _slicedToArray from\"/Users/pavel/Documents/GitHub/test-task-avito/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import styles from\"./GamePage.module.scss\";import{useAppDispatch,useAppSelector}from\"../../hooks\";import{useEffect,useState}from\"react\";import{getOneGame,setGameLoadingStatus}from\"../../redux/slices/gamesSlice\";import{useNavigate,useParams}from\"react-router-dom\";import{FullGameLeft}from\"../../components/FullGameLeft\";import{FullGameRight}from\"../../components/FullGameRight\";import{Button,Icon,Loader}from\"cutie-ui\";import{Status}from\"../../redux/types/types\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var GamePage=function GamePage(){var navigate=useNavigate();var dispatch=useAppDispatch();var data=useAppSelector(function(state){return state.games.currentGameData;});var _useParams=useParams(),id=_useParams.id;var handleClickBack=function handleClickBack(){navigate(-1);};var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),gameData=_useState2[0],setGameData=_useState2[1];var loadingStatus=useAppSelector(function(state){return state.games.gameLoadingStatus;});// ================ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã –≤ Localstorage –Ω–∞ 5 –º–∏–Ω—É—Ç ===================\nvar currentTime=new Date().getTime();var FIVE_MINUTES=5*60*1000;function isCardAvailable(gameId){var localStorageData=localStorage.getItem(\"game_\".concat(gameId));var storedTime=localStorageData?JSON.parse(localStorageData).currentTime:null;if(storedTime){var _currentTime=new Date().getTime();return _currentTime-parseInt(storedTime)<=FIVE_MINUTES;}return false;}function addCardToLS(data){localStorage.removeItem(\"game_\".concat(data===null||data===void 0?void 0:data.id));if(data){localStorage.setItem(\"game_\".concat(data.id),JSON.stringify({data:data,currentTime:currentTime}));}}useEffect(function(){if(id){var cardAvailable=isCardAvailable(id);if(cardAvailable){// @ts-ignore\nvar localStorageData=JSON.parse(localStorage.getItem(\"game_\".concat(id)));setGameData(localStorageData.data);dispatch(setGameLoadingStatus(Status.SUCCESS));}else{var _id=+id;dispatch(getOneGame({id:_id}));if(loadingStatus===\"success\"){addCardToLS(data);setGameData(data);}else if(loadingStatus==\"error\"){dispatch(setGameLoadingStatus(Status.ERROR));}}}return function(){dispatch(setGameLoadingStatus(Status.LOADING));};},[loadingStatus]);// ==================================================================================================\nreturn/*#__PURE__*/_jsx(_Fragment,{children:loadingStatus==\"loading\"?/*#__PURE__*/_jsx(Loader,{className:styles.loader}):loadingStatus==\"error\"?/*#__PURE__*/_jsxs(\"div\",{className:styles.error,children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0438\\u0433\\u0440\\u0443 \\uD83D\\uDE22\"}),/*#__PURE__*/_jsx(Button,{color:\"var(--textPrimary)\",onClick:handleClickBack,variant:\"text2\",className:styles.buttonBack,size:\"large\",startIcon:/*#__PURE__*/_jsx(Icon,{children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",fill:\"none\",viewBox:\"0 0 24 24\",strokeWidth:1.5,stroke:\"currentColor\",className:\"w-6 h-6\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",d:\"M15.75 19.5L8.25 12l7.5-7.5\"})})}),children:\"\\u041D\\u0430\\u0437\\u0430\\u0434\"})]}):loadingStatus==\"success\"?/*#__PURE__*/_jsx(\"div\",{className:styles.root,children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:styles.gamepage,children:[/*#__PURE__*/_jsx(FullGameLeft,{data:gameData}),/*#__PURE__*/_jsx(FullGameRight,{data:gameData})]})})}):\"\"});};","map":{"version":3,"names":["styles","useAppDispatch","useAppSelector","useEffect","useState","getOneGame","setGameLoadingStatus","useNavigate","useParams","FullGameLeft","FullGameRight","Button","Icon","Loader","Status","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","GamePage","navigate","dispatch","data","state","games","currentGameData","_useParams","id","handleClickBack","_useState","undefined","_useState2","_slicedToArray","gameData","setGameData","loadingStatus","gameLoadingStatus","currentTime","Date","getTime","FIVE_MINUTES","isCardAvailable","gameId","localStorageData","localStorage","getItem","concat","storedTime","JSON","parse","parseInt","addCardToLS","removeItem","setItem","stringify","cardAvailable","SUCCESS","_id","ERROR","LOADING","children","className","loader","error","color","onClick","variant","buttonBack","size","startIcon","xmlns","fill","viewBox","strokeWidth","stroke","strokeLinecap","strokeLinejoin","d","root","gamepage"],"sources":["/Users/pavel/Documents/GitHub/test-task-avito/src/pages/GamePage/index.tsx"],"sourcesContent":["import styles from \"./GamePage.module.scss\";\nimport { useAppDispatch, useAppSelector } from \"../../hooks\";\nimport { useEffect, useRef, useState } from \"react\";\nimport {\n  getOneGame,\n  setGameLoadingStatus,\n} from \"../../redux/slices/gamesSlice\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { FullGameLeft } from \"../../components/FullGameLeft\";\nimport { FullGameRight } from \"../../components/FullGameRight\";\nimport { Button, Icon, Loader } from \"cutie-ui\";\nimport { Game, Status } from \"../../redux/types/types\";\n\nexport const GamePage = () => {\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const data = useAppSelector((state) => state.games.currentGameData);\n  const { id } = useParams();\n\n  const handleClickBack = () => {\n    navigate(-1);\n  };\n\n  const [gameData, setGameData] = useState<Game | undefined>(undefined);\n  const loadingStatus = useAppSelector(\n    (state) => state.games.gameLoadingStatus\n  );\n\n  // ================ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã –≤ Localstorage –Ω–∞ 5 –º–∏–Ω—É—Ç ===================\n  const currentTime: number = new Date().getTime();\n  const FIVE_MINUTES: number = 5 * 60 * 1000;\n\n  function isCardAvailable(gameId: string) {\n    const localStorageData: string | null = localStorage.getItem(\n      `game_${gameId}`\n    );\n    const storedTime = localStorageData\n      ? JSON.parse(localStorageData).currentTime\n      : null;\n    if (storedTime) {\n      const currentTime: number = new Date().getTime();\n      return currentTime - parseInt(storedTime) <= FIVE_MINUTES;\n    }\n    return false;\n  }\n\n  function addCardToLS(data?: Game) {\n    localStorage.removeItem(`game_${data?.id}`);\n    if (data) {\n      localStorage.setItem(\n        `game_${data.id}`,\n        JSON.stringify({ data, currentTime })\n      );\n    }\n  }\n\n  useEffect(() => {\n    if (id) {\n      const cardAvailable = isCardAvailable(id);\n      if (cardAvailable) {\n        // @ts-ignore\n        const localStorageData = JSON.parse(localStorage.getItem(`game_${id}`));\n        setGameData(localStorageData.data);\n        dispatch(setGameLoadingStatus(Status.SUCCESS));\n      } else {\n        const _id = +id;\n        dispatch(getOneGame({ id: _id }));\n        if (loadingStatus === \"success\") {\n          addCardToLS(data);\n          setGameData(data);\n        } else if (loadingStatus == \"error\") {\n          dispatch(setGameLoadingStatus(Status.ERROR));\n        }\n      }\n    }\n\n    return () => {\n      dispatch(setGameLoadingStatus(Status.LOADING));\n    };\n  }, [loadingStatus]);\n  // ==================================================================================================\n\n  return (\n    <>\n      {loadingStatus == \"loading\" ? (\n        <Loader className={styles.loader} />\n      ) : loadingStatus == \"error\" ? (\n        <div className={styles.error}>\n          <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É üò¢</p>\n\n          <Button\n            color=\"var(--textPrimary)\"\n            onClick={handleClickBack}\n            variant=\"text2\"\n            className={styles.buttonBack}\n            size=\"large\"\n            startIcon={\n              <Icon>\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  strokeWidth={1.5}\n                  stroke=\"currentColor\"\n                  className=\"w-6 h-6\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M15.75 19.5L8.25 12l7.5-7.5\"\n                  />\n                </svg>\n              </Icon>\n            }\n          >\n            –ù–∞–∑–∞–¥\n          </Button>\n        </div>\n      ) : loadingStatus == \"success\" ? (\n        <div className={styles.root}>\n          <div className=\"container\">\n            <div className={styles.gamepage}>\n              <FullGameLeft data={gameData} />\n              <FullGameRight data={gameData} />\n            </div>\n          </div>\n        </div>\n      ) : (\n        \"\"\n      )}\n    </>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}